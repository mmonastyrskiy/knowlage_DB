Команда file – стандартная утилита, входящая в состав большинства операционных систем типа *nix, а также в подсистему Windows для Linux (Windows Subsystem for Linux – WSL) 1 . Пользователи Windows могут получить эту команду, установив Cygwin или MinGW2 . Команда file пытается определить тип файла, анализируя некоторые поля в нем. Иногда file распознает хорошо известные строки, например #!/bin/sh (скрипт оболочки) или (HTML-документ). Файлы с нетекстовым содержимым сложнее. В таких случаях file пытается определить, соответствует ли структура файла какому-нибудь известному формату. Часто она ищет некоторые признаки (называемые магическими числами) 3 , уникальные для файлов данного типа. Ниже приведены примеры некоторых магических чисел и соответствующих им типов файлов

Команда file распознает много форматов, в т. ч. несколько типов текстовых ASCII-файлов, различные исполняемые файлы и файлы данных. Правила проверки магических чисел хранятся в магическом файле. Где этот файл находится по умолчанию, зависит от операционной системы, типичные местоположения: /usr/share/file/magic, /usr/share/misc/magic и /etc/magic. Дополнительные сведения о магических файлах смотрите в документации по программе file. В некоторых случаях file умеет распознавать вариации в пределах заданного типа файла. В листинге ниже показано, что file распознает не только несколько вариантов формата ELF, но также выдает информацию о том, как файл был скомпонован (статически или динамически) и был ли он обработан программой [[strip]], удаляющей информацию о символах


Утилита file и ей подобные не дают стопроцентно верного результата. Вполне может случиться, что файл распознан неправильно, потому что он случайно содержит характерные признаки определенного формата. Можете убедиться в этом сами, заменив в шестнадцатеричном редакторе первые 4 байта любого файла магической последовательностью Java: CA FE BA BE. После этого file некорректно идентифицирует модифицированный файл как откомпилированный класс Java. Аналогично текстовый файл, содержащий всего два символа MZ, будет идентифицирован как исполняемый файл MS-DOS. В процессе обратной разработки лучше всего не доверять полностью результату любого инструмента, не сопоставив результаты нескольких инструментов и не проанализировав данные вручную.